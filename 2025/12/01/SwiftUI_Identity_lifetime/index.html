<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"sunsetwan.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"default"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"æœç´¢...","empty":"æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æœç´¢ç»“æœï¼š${query}","hits_time":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰","hits":"æ‰¾åˆ° ${hits} ä¸ªæœç´¢ç»“æœ"}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="å‰é˜µå­é‡åˆ°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ BUGï¼šç”¨ NavigationStack push ä¸€ä¸ª Viewï¼ŒCPU ä½¿ç”¨ç‡ç«Ÿç„¶å†²ä¸Š 100 %ï¼å½“ Xcode è¿è¡Œä¸€æ®µ SwiftUI ä»£ç æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…³æ³¨å“ªäº›æ–¹é¢ï¼Ÿç‰¹æ­¤å›é¡¾ WWDC 21 Demystify SwiftUIã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="SwiftUI View çš„ Identity ä¸ Lifetime">
<meta property="og:url" content="https://sunsetwan.github.io/2025/12/01/SwiftUI_Identity_lifetime/index.html">
<meta property="og:site_name" content="æ—¥è½å¤§é“">
<meta property="og:description" content="å‰é˜µå­é‡åˆ°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ BUGï¼šç”¨ NavigationStack push ä¸€ä¸ª Viewï¼ŒCPU ä½¿ç”¨ç‡ç«Ÿç„¶å†²ä¸Š 100 %ï¼å½“ Xcode è¿è¡Œä¸€æ®µ SwiftUI ä»£ç æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…³æ³¨å“ªäº›æ–¹é¢ï¼Ÿç‰¹æ­¤å›é¡¾ WWDC 21 Demystify SwiftUIã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/01.jpeg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/02.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/03.gif">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/04.gif">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/05.png">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/06.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/07.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/08.png">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/09.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/10.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/11.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/12.jpg">
<meta property="article:published_time" content="2025-12-01T23:33:33.000Z">
<meta property="article:modified_time" content="2025-12-02T00:16:51.725Z">
<meta property="article:author" content="Sunset Wan">
<meta property="article:tag" content="SwiftUI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/01.jpeg">


<link rel="canonical" href="https://sunsetwan.github.io/2025/12/01/SwiftUI_Identity_lifetime/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://sunsetwan.github.io/2025/12/01/SwiftUI_Identity_lifetime/","path":"2025/12/01/SwiftUI_Identity_lifetime/","title":"SwiftUI View çš„ Identity ä¸ Lifetime"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SwiftUI View çš„ Identity ä¸ Lifetime | æ—¥è½å¤§é“</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ " role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">æ—¥è½å¤§é“</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="æœç´¢" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>é¦–é¡µ</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>å…³äº</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>å½’æ¡£</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Identity"><span class="nav-number">1.</span> <span class="nav-text">Identity</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E4%B8%80%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%E7%BB%BF%E8%89%B2%E7%88%AA%E5%8D%B0%E6%B6%88%E5%A4%B1%E5%90%8E%E5%86%8D%E5%87%BA%E7%8E%B0%E7%BA%A2%E8%89%B2%E7%88%AA%E5%8D%B0%E5%91%A2%EF%BC%9F"><span class="nav-number">1.1.</span> <span class="nav-text">é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆæ˜¯ç»¿è‰²çˆªå°æ¶ˆå¤±åå†å‡ºç°çº¢è‰²çˆªå°å‘¢ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E4%BA%8C%EF%BC%9A%E5%8D%95%E4%B8%AA%E7%88%AA%E5%8D%B0%E7%9B%B4%E6%8E%A5%E4%BB%8E%E7%BB%BF%E8%89%B2%E8%BF%87%E6%B8%A1%E5%88%B0%E7%BA%A2%E8%89%B2%E5%BA%94%E8%AF%A5%E4%BC%9A%E6%9B%B4%E4%B8%9D%E6%BB%91%EF%BC%8C%E6%88%91%E8%A6%81%E6%80%8E%E4%B9%88%E5%81%9A%EF%BC%9F"><span class="nav-number">1.2.</span> <span class="nav-text">é—®é¢˜äºŒï¼šå•ä¸ªçˆªå°ç›´æ¥ä»ç»¿è‰²è¿‡æ¸¡åˆ°çº¢è‰²åº”è¯¥ä¼šæ›´ä¸æ»‘ï¼Œæˆ‘è¦æ€ä¹ˆåšï¼Ÿ</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Lifetime"><span class="nav-number">2.</span> <span class="nav-text">Lifetime</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dependency"><span class="nav-number">3.</span> <span class="nav-text">Dependency</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9E%E9%A1%BE"><span class="nav-number">4.</span> <span class="nav-text">å›é¡¾</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Sunset Wan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">13</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">æ ‡ç­¾</span>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/SunsetWan" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;SunsetWan" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sunsetwan.github.io/2025/12/01/SwiftUI_Identity_lifetime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sunset Wan">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ—¥è½å¤§é“">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SwiftUI View çš„ Identity ä¸ Lifetime | æ—¥è½å¤§é“">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SwiftUI View çš„ Identity ä¸ Lifetime
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">å‘è¡¨äº</span>

      <time title="åˆ›å»ºæ—¶é—´ï¼š2025-12-01 23:33:33" itemprop="dateCreated datePublished" datetime="2025-12-01T23:33:33+00:00">2025-12-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">æ›´æ–°äº</span>
      <time title="ä¿®æ”¹æ—¶é—´ï¼š2025-12-02 00:16:51" itemprop="dateModified" datetime="2025-12-02T00:16:51+00:00">2025-12-02</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>å‰é˜µå­é‡åˆ°ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„ BUGï¼šç”¨ <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/SwiftUI/NavigationStack">NavigationStack</a> push ä¸€ä¸ª Viewï¼ŒCPU ä½¿ç”¨ç‡ç«Ÿç„¶å†²ä¸Š 100 %ï¼å½“ Xcode è¿è¡Œä¸€æ®µ SwiftUI ä»£ç æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…³æ³¨å“ªäº›æ–¹é¢ï¼Ÿç‰¹æ­¤å›é¡¾ <a target="_blank" rel="noopener" href="https://developer.apple.com/videos/play/wwdc2021/10022/">WWDC 21 Demystify SwiftUI</a>ã€‚ <span id="more"></span></p>
<p>å½“ Xcode è¿è¡Œä¸€æ®µ SwiftUI ä»£ç æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥å…³æ³¨å“ªäº›æ–¹é¢ï¼Ÿ</p>
<ol>
<li>Identityâ€”æ˜¯ SwiftUI ç”¨æ¥åŒºåˆ†è§†å›¾å…ƒç´ çš„â€œèº«ä»½è¯â€</li>
<li>Lifetimeâ€”æ˜¯ SwiftUI ç”¨æ¥ç®¡ç†è§†å›¾ä¸å…¶ç›¸å…³çŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸ</li>
<li>Dependencyâ€”æ˜¯ SwiftUI ç”¨æ¥å†³å®šè§†å›¾ä¸ºä½•ä»¥åŠä½•æ—¶éœ€è¦æ›´æ–°</li>
</ol>
<h2 id="Identity"><a href="#Identity" class="headerlink" title="Identity"></a>Identity</h2><p>SwiftUI ä¸­ Identity åˆ†ä¸ºä¸¤ç§ï¼šExplicit Identity å’Œ Structural Identityã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/01.jpeg" alt="alt text"></p>
<p>å½“é‡åˆ°ä¸¤ä¸ªå¤–è¡¨å¾ˆç›¸ä¼¼çš„åŒèƒèƒï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•åŒºåˆ†ï¼Ÿå¯¹ï¼Œå¯ä»¥é€šè¿‡å§“åæ¥åŒºåˆ†ï¼è¿™å°±æ˜¯ Explicit Identityã€‚</p>
<p>æˆ‘æŸ¥äº†ç‚¹èµ„æ–™ï¼Œæˆ‘ä»¬ä»…çŸ¥é“è¿™å¯¹è‘—åçš„åŒèƒèƒå§å¦¹æ˜¯æ ¼é›·è¿ªåŒèƒèƒå§å¦¹ï¼Œå¹¶ä¸çŸ¥é“å„è‡ªçš„å§“åã€‚é‚£æˆ‘é—®ä½ ï¼šä½ è§‰å¾—å“ªä¸ªæ›´ææ€–ä¸€ç‚¹ï¼Ÿæˆ‘æ˜¯è§‰å¾—å·¦è¾¹é‚£ä½æ›´ææ€–ä¸€äº›ã€‚<br>é€šè¿‡å¥¹ä¿©çš„ç›¸å¯¹ä½ç½®æ¥åŒºåˆ†ï¼šä¸€ä½æ˜¯ç«™åœ¨å·¦è¾¹ï¼Œå¦ä¸€ä½æ˜¯ç«™åœ¨å³è¾¹ã€‚è¿™å°±æ˜¯ Structural Identityã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ›´å®é™…çš„ä¾‹å­ï¼š</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/02.jpg" alt="02.jpg"></p>
<p>å·¦è¾¹çš„ä»£ç åœ¨ SwiftUI â€œçœ¼é‡Œâ€å½“æ¡ä»¶ä¸ºçœŸæ—¶æ˜¾ç¤º <code>AdoptionDirectory</code> è§†å›¾ï¼Œæ¡ä»¶ä¸ºå‡æ—¶æ˜¾ç¤º <code>DogList</code> è§†å›¾ã€‚åªè¦æ¡ä»¶æ’å®šï¼ŒSwiftUI èƒ½çŸ¥é“å“ªä¸ªæ˜¯â€œçœŸåˆ†æ”¯â€å“ªä¸ªæ˜¯â€œå‡åˆ†æ”¯â€ã€‚</p>
<p>View body ä¸­çš„ if è¯­å¥åœ¨ SwiftUI é‡Œä¼šè¢«ç¼–è¯‘æˆ _ConditionalContent&lt;TrueView, FalseView&gt; è¿™æ ·çš„æ³›å‹ç±»å‹ï¼ŒTrueView å’Œ FalseView æ˜¯ä¸¤ä¸ªåˆ†æ”¯çš„å…·ä½“ç±»å‹ã€‚è¿™ä¸ªè½¬æ¢ç”± <a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/swiftui/viewbuilder">ViewBuilder</a> å®Œæˆã€‚<br>View åè®®çš„ body ä¼šéšå¼åŒ…è£¹åœ¨ ViewBuilder ä¸­ï¼ŒViewBuilder ä¼šæŠŠ body é‡Œçš„æ¡ä»¶é€»è¾‘æ‹¼æˆä¸€ä¸ªç»Ÿä¸€çš„æ³›å‹è§†å›¾ç±»å‹ã€‚</p>
<p>Structural Identity æ˜¯ Swift é€šè¿‡è§†å›¾å…ƒç´ åœ¨è§†å›¾å±‚çº§ä¸­çš„ç±»å‹ä¸ä½ç½®æ¥è¯†åˆ«è§†å›¾èº«ä»½çš„æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç‚¹å‡»äº‹ä»¶æ¥æ›´æ–° <code>dog.isGood</code> çŠ¶æ€ï¼Œä»è€Œè§¦å‘ <code>pawView</code> çš„åˆ·æ–°ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ViewBuilder</span></span><br><span class="line"><span class="keyword">var</span> pawView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> dog.isGood &#123;</span><br><span class="line">        <span class="type">PawView</span>(tint: .green)</span><br><span class="line">            .padding(.top, <span class="number">32</span>)</span><br><span class="line">        <span class="type">Spacer</span>()</span><br><span class="line">            .padding(.bottom, <span class="number">32</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">Spacer</span>()</span><br><span class="line">        <span class="type">PawView</span>(tint: .red)</span><br><span class="line">            .padding(.bottom, <span class="number">32</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/03.gif" alt="Simulator Screen Recording - iPhone 17 - 2025-11-30 at 12.53.09.gif"></p>
<h3 id="é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆæ˜¯ç»¿è‰²çˆªå°æ¶ˆå¤±åå†å‡ºç°çº¢è‰²çˆªå°å‘¢ï¼Ÿ"><a href="#é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆæ˜¯ç»¿è‰²çˆªå°æ¶ˆå¤±åå†å‡ºç°çº¢è‰²çˆªå°å‘¢ï¼Ÿ" class="headerlink" title="é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆæ˜¯ç»¿è‰²çˆªå°æ¶ˆå¤±åå†å‡ºç°çº¢è‰²çˆªå°å‘¢ï¼Ÿ"></a>é—®é¢˜ä¸€ï¼šä¸ºä»€ä¹ˆæ˜¯ç»¿è‰²çˆªå°æ¶ˆå¤±åå†å‡ºç°çº¢è‰²çˆªå°å‘¢ï¼Ÿ</h3><p>å› ä¸º SwiftUI æ˜¯é€šè¿‡ Structural Identity æ¥åŒºåˆ†ç»¿è‰²çˆªå°å’Œçº¢è‰²çˆªå°ï¼Œå½“ <code>dog.isGood</code> å˜åŒ–æ—¶ï¼ŒSwiftUI è®¤ä¸ºå®ƒéœ€è¦é”€æ¯ç»¿è‰²çˆªå°è§†å›¾å’Œåˆ›å»ºçº¢è‰²çˆªå°è§†å›¾ã€‚</p>
<p>ä¸éš¾å¾—å‡ºï¼šè§†å›¾çš„ Identity å‘ç”Ÿå˜åŒ–åï¼ŒSwiftUI ä¼šè®¤ä¸ºå®ƒéœ€è¦é”€æ¯æ—§è§†å›¾å¹¶åˆ›å»ºæ–°è§†å›¾ã€‚</p>
<h3 id="é—®é¢˜äºŒï¼šå•ä¸ªçˆªå°ç›´æ¥ä»ç»¿è‰²è¿‡æ¸¡åˆ°çº¢è‰²åº”è¯¥ä¼šæ›´ä¸æ»‘ï¼Œæˆ‘è¦æ€ä¹ˆåšï¼Ÿ"><a href="#é—®é¢˜äºŒï¼šå•ä¸ªçˆªå°ç›´æ¥ä»ç»¿è‰²è¿‡æ¸¡åˆ°çº¢è‰²åº”è¯¥ä¼šæ›´ä¸æ»‘ï¼Œæˆ‘è¦æ€ä¹ˆåšï¼Ÿ" class="headerlink" title="é—®é¢˜äºŒï¼šå•ä¸ªçˆªå°ç›´æ¥ä»ç»¿è‰²è¿‡æ¸¡åˆ°çº¢è‰²åº”è¯¥ä¼šæ›´ä¸æ»‘ï¼Œæˆ‘è¦æ€ä¹ˆåšï¼Ÿ"></a>é—®é¢˜äºŒï¼šå•ä¸ªçˆªå°ç›´æ¥ä»ç»¿è‰²è¿‡æ¸¡åˆ°çº¢è‰²åº”è¯¥ä¼šæ›´ä¸æ»‘ï¼Œæˆ‘è¦æ€ä¹ˆåšï¼Ÿ</h3><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pawView: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">PawView</span>(tint: dog.isGood <span class="operator">?</span> .green : .red)</span><br><span class="line">        .padding(.top, <span class="number">32</span>)</span><br><span class="line">        .padding(.bottom, <span class="number">32</span>)</span><br><span class="line">        .frame(maxHeight: .infinity, alignment: dog.isGood <span class="operator">?</span> .top : .bottom)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥æŠŠ <code>pawView</code> é‡Œçš„ if åˆ†æ”¯æ‹¿æ‰ï¼Œå•ä¸ª <code>PawView</code> çš„ Structural Identity å°±ä¿æŒä¸å˜ï¼›<code>dog.isGood</code> å˜åŒ–æ—¶ï¼Œåªæ˜¯åŒä¸€ä¸ªè§†å›¾çš„ tintColor å’Œä½ç½®åœ¨å˜ï¼ŒçŠ¶æ€ä¸åŠ¨ç”»éƒ½èƒ½è¿ç»­ã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/04.gif" alt="Simulator Screen Recording - iPhone 17 - 2025-11-30 at 13.24.36.gif"></p>
<h2 id="Lifetime"><a href="#Lifetime" class="headerlink" title="Lifetime"></a>Lifetime</h2><p>æˆ‘ä»¬ç»™ <code>PawView</code> åŠ ä¸Š <code>PawViewState</code> çŠ¶æ€ï¼Œæ¥çœ‹çœ‹ Structural Identity çš„å˜åŒ–å¯¹è§†å›¾çŠ¶æ€çš„å½±å“</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PawViewState</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> id: <span class="type">UUID</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">id</span>: <span class="type">UUID</span> <span class="operator">=</span> <span class="type">UUID</span>()) &#123;</span><br><span class="line">        <span class="keyword">self</span>.id <span class="operator">=</span> id</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;PawViewState(<span class="subst">\(id)</span>) init at <span class="subst">\(Date())</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">deinit</span> &#123;</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;PawViewState(<span class="subst">\(id)</span>) deinit at <span class="subst">\(Date())</span>&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">PawView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> tint: <span class="type">Color</span></span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> state: <span class="type">PawViewState</span> <span class="operator">=</span> .<span class="keyword">init</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">Circle</span>()</span><br><span class="line">            .fill(tint)</span><br><span class="line">            .frame(width: <span class="number">180</span>, height: <span class="number">180</span>)</span><br><span class="line">            .overlay(</span><br><span class="line">                <span class="type">Image</span>(systemName: <span class="string">&quot;pawprint.fill&quot;</span>)</span><br><span class="line">                    .resizable()</span><br><span class="line">                    .scaledToFit()</span><br><span class="line">                    .foregroundColor(.white)</span><br><span class="line">                    .padding(<span class="number">44</span>)</span><br><span class="line">            )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨æˆ‘è§¦å‘ä¸¤æ¬¡ç‚¹å‡»äº‹ä»¶ï¼ˆGood dog â†’ Bad dog, Bad dog â†’ Good dogï¼‰åï¼ŒXcode console è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">PawViewState</span>(39BFC159<span class="operator">-</span><span class="type">AE06</span><span class="operator">-</span>45A5<span class="operator">-</span><span class="number">9083</span><span class="operator">-</span><span class="type">B1C5BDF053C3</span> <span class="keyword">init</span> at <span class="number">2025</span><span class="operator">-</span><span class="number">11</span><span class="operator">-</span><span class="number">30</span> <span class="number">05</span>:<span class="number">42</span>:<span class="number">02</span> <span class="operator">+</span><span class="number">0000</span> <span class="comment">// Good dog 1 init</span></span><br><span class="line"><span class="type">PawViewState</span>(5FB6A6D4<span class="operator">-</span><span class="number">1E81</span><span class="operator">-</span>43A1<span class="operator">-</span>8AB1<span class="operator">-</span>04C2DEE8455A <span class="keyword">init</span> at <span class="number">2025</span><span class="operator">-</span><span class="number">11</span><span class="operator">-</span><span class="number">30</span> <span class="number">05</span>:<span class="number">42</span>:<span class="number">05</span> <span class="operator">+</span><span class="number">0000</span> <span class="comment">// Bad dog 1 init</span></span><br><span class="line"><span class="type">PawViewState</span>(39BFC159<span class="operator">-</span><span class="type">AE06</span><span class="operator">-</span>45A5<span class="operator">-</span><span class="number">9083</span><span class="operator">-</span><span class="type">B1C5BDF053C3</span> <span class="keyword">deinit</span> at <span class="number">2025</span><span class="operator">-</span><span class="number">11</span><span class="operator">-</span><span class="number">30</span> <span class="number">05</span>:<span class="number">42</span>:<span class="number">06</span> <span class="operator">+</span><span class="number">0000</span> <span class="comment">// Good dog 1 deinit</span></span><br><span class="line"><span class="type">PawViewState</span>(33E05E98<span class="operator">-</span><span class="number">2553</span><span class="operator">-</span>4C8D<span class="operator">-</span>81B0<span class="operator">-</span><span class="type">A56E2E353962</span> <span class="keyword">init</span> at <span class="number">2025</span><span class="operator">-</span><span class="number">11</span><span class="operator">-</span><span class="number">30</span> <span class="number">05</span>:<span class="number">42</span>:<span class="number">07</span> <span class="operator">+</span><span class="number">0000</span> <span class="comment">// Good dog 2 init</span></span><br><span class="line"><span class="type">PawViewState</span>(5FB6A6D4<span class="operator">-</span><span class="number">1E81</span><span class="operator">-</span>43A1<span class="operator">-</span>8AB1<span class="operator">-</span>04C2DEE8455A <span class="keyword">deinit</span> at <span class="number">2025</span><span class="operator">-</span><span class="number">11</span><span class="operator">-</span><span class="number">30</span> <span class="number">05</span>:<span class="number">42</span>:<span class="number">08</span> <span class="operator">+</span><span class="number">0000</span> <span class="comment">// Bad dog 1 deinit</span></span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢çš„ä¾‹å­ä¸­æ€»ç»“ï¼š</p>
<ol>
<li>è§†å›¾çš„ Identity å‘ç”Ÿå˜åŒ–åï¼ŒSwiftUI ä¼šè®¤ä¸ºå®ƒéœ€è¦é”€æ¯æ—§è§†å›¾å¹¶åˆ›å»ºæ–°è§†å›¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè§†å›¾çš„ç”Ÿå‘½å‘¨æœŸæ˜¯å¦å»¶ç»­å–å†³äº Identity æ˜¯å¦ä¿æŒä¸å˜ã€‚</li>
<li>SwiftUI é‡ŒçŠ¶æ€çš„ç”Ÿå‘½å‘¨æœŸå’Œè§†å›¾çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ç»‘å®šåœ¨ä¸€èµ·çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªè§†å›¾è¢«åˆ›å»ºæ—¶çŠ¶æ€æ‰ä¼šè¢«åˆ›å»ºï¼Œè§†å›¾è¢«é”€æ¯æ—¶çŠ¶æ€å°±éšä¹‹æ¶ˆå¤±ã€‚</li>
</ol>
<p>å› æ­¤ï¼Œå¯å¾—ï¼š</p>
<p>SwiftUI æŠŠè§†å›¾çš„â€œæœ¬è´¨â€å½’ç»“ä¸ºå®ƒæŒæœ‰çš„çŠ¶æ€ï¼Œå¹¶æŠŠè¿™ä»½çŠ¶æ€å’Œè§†å›¾çš„èº«ä»½ç»‘å®šåœ¨ä¸€èµ·ã€‚<br>èº«ä»½ä¸å˜ï¼ŒçŠ¶æ€å°±è¢«ä¿ç•™ä¸‹æ¥ï¼›èº«ä»½ä¸€å˜ï¼ŒSwiftUI å°±å½“æˆå…¨æ–°çš„è§†å›¾ï¼ŒçŠ¶æ€ä¹Ÿé‡å»ºã€‚è¿™æ ·èƒ½æ¸…æ™°åœ°åŒºåˆ†ï¼šå“ªäº›çŠ¶æ€åº”è¯¥å»¶ç»­ï¼ˆèº«ä»½ç¨³å®šçš„è§†å›¾ï¼‰ï¼Œå“ªäº›çŠ¶æ€åº”è¯¥é‡ç½®ï¼ˆèº«ä»½å˜åŒ–çš„è§†å›¾ï¼‰</p>
<p>å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œæ¥è¾…åŠ©ç†è§£ä¸Šé¢çš„æ€»ç»“ã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/05.png" alt="image.png"></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Pet</span>: <span class="title class_ inherited__">Identifiable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> kind: <span class="type">Animal</span></span><br><span class="line">    <span class="keyword">var</span> id: <span class="type">UUID</span> &#123; <span class="comment">// ä¸ç¨³å®šçš„ identity</span></span><br><span class="line">        <span class="type">UUID</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">FavoritePetsView</span>: <span class="title class_ inherited__">View</span> &#123;</span><br><span class="line">    <span class="meta">@State</span> <span class="keyword">private</span> <span class="keyword">var</span> pets: [<span class="type">Pet</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">pets</span>: [<span class="type">Pet</span>]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.pets <span class="operator">=</span> pets</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="type">NavigationStack</span> &#123;</span><br><span class="line">            <span class="type">List</span> &#123;</span><br><span class="line">                <span class="type">ForEach</span>(pets) &#123; pet <span class="keyword">in</span></span><br><span class="line">                    <span class="type">PetRow</span>(pet: pet)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .listStyle(.plain)</span><br><span class="line">            .navigationTitle(<span class="string">&quot;Favorite Pets&quot;</span>)</span><br><span class="line">            .toolbar &#123;</span><br><span class="line">                <span class="type">ToolbarItem</span>(placement: .topBarTrailing) &#123;</span><br><span class="line">                    <span class="type">Button</span>(<span class="string">&quot;Add&quot;</span>) &#123;</span><br><span class="line">                        addTomCat()</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">addTomCat</span>() &#123;</span><br><span class="line">        <span class="keyword">let</span> newPet <span class="operator">=</span> <span class="type">Pet</span>(name: <span class="string">&quot;æ±¤å§†&quot;</span>, kind: .cat)</span><br><span class="line">        pets.insert(newPet, at: <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç‚¹å‡» add æŒ‰é’®æ—¶ï¼Œâ€œæ±¤å§†â€çŒ«å‡ºç°åœ¨ List çš„é¦–ä½ã€‚è®©æˆ‘ä»¬ç”¨ SwiftUI Instruments æ¥æŸ¥çœ‹å½“å‰è§†å›¾çš„æ›´æ–°æ¬¡æ•°</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/06.jpg" alt="03.jpg"></p>
<p>å› ä¸º PetRow Identity çš„ä¸ç¨³å®šæ€§ï¼Œå¯¼è‡´ <code>PetRow</code> çš„ body è¢«æ‰§è¡Œå¤šæ¬¡ã€‚å¦‚æœæ”¾åœ¨ä¸€ä¸ªå¤§å‹é¡¹ç›®ä¸­ï¼Œå¯èƒ½ä¼šå¯¼è‡´ App å‡ºç°å¡é¡¿ã€‚</p>
<p>ä½¿ç”¨è®¡ç®—å±æ€§ç”Ÿæˆ UUID çš„æ–¹å¼éµå¾ª <code>Identifiable</code> ä¼šå¯¼è‡´è§†å›¾ Identity ä¸ç¨³å®šï¼Œæ‰€ä»¥ä½œå¦‚ä¸‹ä¿®æ”¹ï¼Œä»¥æä¾›ç¨³å®šçš„ Identityã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Pet</span>: <span class="title class_ inherited__">Identifiable</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> name: <span class="type">String</span></span><br><span class="line">    <span class="keyword">var</span> kind: <span class="type">Animal</span></span><br><span class="line">    <span class="keyword">let</span> id <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥å†æ¬¡è¿è¡Œ SwiftUI Instruments æ¥æŸ¥çœ‹å½“å‰è§†å›¾çš„æ›´æ–°æ¬¡æ•°ï¼š</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/07.jpg" alt="04.jpg"></p>
<p>PetRow çš„ body è¢«æ‰§è¡Œçš„æ¬¡æ•°é”å‡è‡³ 6 æ¬¡ï¼åŸæœ¬å·²æœ‰ 5 ä¸ªå® ç‰©ï¼Œå†åŠ ä¸Šæ–°å¢çš„â€œæ±¤å§†â€çŒ«ï¼Œæ€»è®¡ 6 æ¬¡ï¼Œä¸é¢„æœŸç›¸ç¬¦ã€‚</p>
<p>å†çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹ç‚¹çš„ä¾‹å­</p>
<p>Treat Jar View å±•ç¤ºçš„æ˜¯ç»™å® ç‰©å‡†å¤‡çš„é›¶é£Ÿã€‚å¦‚æœæœ‰é›¶é£Ÿè¿‡æœŸï¼Œé‚£å°±ç½®ç°ã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/08.png" alt="08.png"></p>
<p>æˆ‘ä»¬å€ŸåŠ©äº <code>ExpirationModifier</code> æ¥å®ç°ç½®ç°çš„æ•ˆæœã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> body: <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">    <span class="type">NavigationStack</span> &#123;</span><br><span class="line">        <span class="type">ScrollView</span> &#123;</span><br><span class="line">            <span class="type">LazyVGrid</span>(columns: columns, spacing: <span class="number">16</span>) &#123;</span><br><span class="line">                <span class="type">ForEach</span>(treats, id: \.serialNumber) &#123; treat <span class="keyword">in</span></span><br><span class="line">                    <span class="type">TreatCell</span>(treat: treat)</span><br><span class="line">                        .modifier(<span class="type">ExpirationModifier</span>(date: treat.expiryDate, referenceDate: referenceDate))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            .padding(<span class="number">16</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        .background(<span class="type">Color</span>(.systemGroupedBackground))</span><br><span class="line">        .navigationTitle(<span class="string">&quot;Treat Jar&quot;</span>)</span><br><span class="line">        .toolbar &#123;</span><br><span class="line">            <span class="type">ToolbarItem</span>(placement: .topBarLeading) &#123;</span><br><span class="line">                <span class="type">Button</span>(referenceDateIsExpired <span class="operator">?</span> <span class="string">&quot;Restore&quot;</span> : <span class="string">&quot;Expire&quot;</span>) &#123;</span><br><span class="line">                    toggleExpirationSimulation()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ExpirationModifier</span>: <span class="title class_ inherited__">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> date: <span class="type">Date</span></span><br><span class="line">    <span class="keyword">var</span> referenceDate: <span class="type">Date</span> <span class="operator">=</span> .now</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> date <span class="operator">&lt;</span> referenceDate &#123;</span><br><span class="line">            content.opacity(<span class="number">0.3</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            content</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶æ‰§è¡Œç‚¹å‡»å·¦ä¸Šè§’ Expire æŒ‰é’®æ¥æ¨¡æ‹Ÿæ‰€æœ‰çš„é›¶é£Ÿè¿‡æœŸã€‚SwiftUI Instruments ç»™å‡ºçš„è§†å›¾æ›´æ–°æ¬¡æ•°å¦‚ä¸‹ï¼š</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/09.jpg" alt="06.jpg"></p>
<p>ä»£è¡¨ä¸¤ç§é›¶é£Ÿçš„ TreatCell åˆ›å»ºäº†ä¸¤æ¬¡ï¼Œä½†å®é™…ä¸Šé›¶é£Ÿè¿‡æœŸåï¼Œåªéœ€ç½®ç°å³å¯ï¼Œä¸éœ€è¦é‡æ–°åˆ›å»º TreatCellã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ExpirationModifier</span>: <span class="title class_ inherited__">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> date: <span class="type">Date</span></span><br><span class="line">    <span class="keyword">var</span> referenceDate: <span class="type">Date</span> <span class="operator">=</span> .now</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> date <span class="operator">&lt;</span> referenceDate &#123; <span class="comment">// Structural Identity</span></span><br><span class="line">            content.opacity(<span class="number">0.3</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            content</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨äº† <code>ExpirationModifier</code> ä¹‹åï¼Œ <code>ForEach</code> ä¸­çš„ <code>Content View</code> çš„ Identity å±äº Structural Identity</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ForEach ä¸­çš„ Content View</span></span><br><span class="line"><span class="type">TreatCell</span>(treat: treat)</span><br><span class="line"> .modifier(<span class="type">ExpirationModifier</span>(date: treat.expiryDate, referenceDate: referenceDate))</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä¹‹å‰çš„ç»éªŒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥ä¼˜åŒ–ï¼Œå³å»é™¤ if åˆ†æ”¯ï¼š</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">ExpirationModifier</span>: <span class="title class_ inherited__">ViewModifier</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> date: <span class="type">Date</span></span><br><span class="line">    <span class="keyword">var</span> referenceDate: <span class="type">Date</span> <span class="operator">=</span> .now</span><br><span class="line"></span><br><span class="line">    <span class="keyword">func</span> <span class="title function_">body</span>(<span class="params">content</span>: <span class="type">Content</span>) -&gt; <span class="keyword">some</span> <span class="type">View</span> &#123;</span><br><span class="line">        content.opacity(date <span class="operator">&lt;</span> referenceDate <span class="operator">?</span> <span class="number">0.3</span> : <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ SwiftUI Instrumentsï¼Œå†æ¬¡ç‚¹å‡»å·¦ä¸Šè§’ Expire æŒ‰é’®ï¼Œå¯ä»¥çœ‹åˆ°ï¼š</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/10.jpg" alt="07.jpg"></p>
<p>TreatCell.body æ²¡æœ‰å†è¢«æ‰§è¡Œè¿‡äº†ï¼æ‰€ä»¥åœ¨ View ä¸­ä½¿ç”¨ if åˆ†æ”¯æ—¶ï¼Œå¯ä»¥åœä¸‹æ¥é—®è‡ªå·±ï¼šæˆ‘æ˜¯è¦å¤šä¸ªè§†å›¾è¿˜æ˜¯æŸä¸€è§†å›¾çš„ä¸¤ç§çŠ¶æ€å‘¢ï¼Ÿå¼•å…¥ä¸å¿…è¦çš„åˆ†æ”¯ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œç”šè‡³è§†å›¾çš„çŠ¶æ€ä¸¢å¤±ã€‚</p>
<h2 id="Dependency"><a href="#Dependency" class="headerlink" title="Dependency"></a>Dependency</h2><p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/11.jpg" alt="09.jpg"></p>
<p>ï¼ˆæœ¬èŠ‚ä¸æ˜¯æœ¬æ–‡è®¨è®ºçš„é‡ç‚¹ï¼Œäºæ˜¯æˆ‘æ”¾ä¸Š AI å¯¹æ­¤çš„æ€»ç»“ï¼‰</p>
<ul>
<li>ä¾èµ–çš„å«ä¹‰ï¼šè§†å›¾çš„è¾“å…¥ï¼ˆå±æ€§ã€@State&#x2F;@Binding&#x2F;@Environment&#x2F;ObservableObject ç­‰ï¼‰ã€‚ä¾èµ–ä¸€æ—¦<br>å˜æ›´ï¼Œå¯¹åº”è§†å›¾å°±å¿…é¡»é‡æ–°è®¡ç®— bodyã€‚</li>
<li>ä¾èµ–å…³ç³»çš„ç»“æ„ï¼šè™½ç„¶è§†å›¾å±‚çº§åƒæ ‘ï¼Œä½†åŒä¸€ä¸ªä¾èµ–å¯è¢«å¤šå¤„ä½¿ç”¨ï¼Œæ•´ä½“æ›´åƒä¸€å¼ ä¾èµ–å›¾ã€‚æŸä¸ªä¾èµ–å˜<br>åŒ–æ—¶ï¼ŒSwiftUI åªè®©ä¾èµ–å®ƒçš„è§†å›¾é‡å»ºï¼Œè€Œä¸æ˜¯å…¨é‡åˆ·æ–°ã€‚</li>
<li>èº«ä»½åœ¨å…¶ä¸­çš„ä½œç”¨ï¼šè§†å›¾çš„èº«ä»½ï¼ˆæ˜¾å¼ id æˆ–ç»“æ„èº«ä»½ï¼‰å†³å®šä¾èµ–å˜åŒ–å¦‚ä½•è¢«è·¯ç”±åˆ°å…·ä½“èŠ‚ç‚¹ï¼›èº«ä»½ç¨³<br>å®šï¼Œå°±èƒ½æ›´å¥½åœ°ä¿æŒçŠ¶æ€å’Œé¿å…å¤šä½™é‡å»ºã€‚</li>
<li>é€‰æ‹©ç¨³å®šä¸”å”¯ä¸€çš„æ ‡è¯†ï¼šæ•°æ®é©±åŠ¨çš„è§†å›¾ï¼ˆForEach ç­‰ï¼‰éœ€è¦ç¨³å®šã€å”¯ä¸€çš„ idã€‚éšæœº id æˆ–æ•°ç»„ä¸‹æ ‡ä¼šè®©èº«ä»½æ¼‚ç§»ï¼Œé€ æˆé—ªçƒã€é”™è¯¯åŠ¨ç”»æˆ–çŠ¶æ€ä¸¢å¤±ã€‚</li>
<li>ç²¾ç®€æ¡ä»¶åˆ†æ”¯ï¼šå¤šä½™çš„ if&#x2F;switch ä¼šåˆ¶é€ é¢å¤–çš„èº«ä»½èŠ‚ç‚¹ï¼Œå¯¼è‡´é‡å¤é‡å»ºã€‚èƒ½ç”¨â€œæƒ°æ€§â€ä¿®é¥°ç¬¦ï¼ˆå¦‚æ¡ä»¶<br>æ”¾è¿› opacityï¼Œ1 æ—¶æ— å½±å“ï¼‰æŠ˜å æ¡ä»¶æ—¶ï¼Œæ›´æ–°ä¼šæ›´é›†ä¸­é«˜æ•ˆã€‚</li>
<li>æ›´æ–°æµç¨‹å¿ƒæ™ºæ¨¡å‹ï¼šä¾èµ–å˜åŒ– â†’ æ ‡è®°ç›¸å…³è§†å›¾ â†’ é‡æ–°æ±‚ body ç”Ÿæˆæ–°å€¼ï¼›å€¼æœ¬èº«æ˜¯çŸ­æš‚å¯¹æ¯”ç”¨çš„ï¼ŒæŒ<br>ä¹…çŠ¶æ€ä¸è§†å›¾èº«ä»½ç»‘å®šå¹¶éšèº«ä»½å­˜ç»­ã€‚</li>
</ul>
<h2 id="å›é¡¾"><a href="#å›é¡¾" class="headerlink" title="å›é¡¾"></a>å›é¡¾</h2><p>è¿˜è®°å¾—æ–‡ç« å¼€å¤´æˆ‘æåŠçš„å¥‡æ€ª BUG å—ï¼Ÿè¿™æ˜¯èƒ½å¤ç°çš„ demoï¼Œè€Œä¸”åœ¨ iOS 17.1.2 ä¸Šèƒ½ç¨³å®šå¤ç°ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typealias</span> <span class="type">DetailState</span> <span class="operator">=</span> <span class="type">DetailViewModel</span>.<span class="type">State</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">DetailViewModel</span>: <span class="title class_ inherited__">ObservableObject</span> &#123;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">State</span>: <span class="title class_ inherited__">Identifiable</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> title: <span class="type">String</span></span><br><span class="line">        <span class="keyword">let</span> subtitle: <span class="type">String</span></span><br><span class="line">        <span class="keyword">var</span> text: <span class="type">String</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">        <span class="keyword">var</span> id: <span class="type">UUID</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> newID <span class="operator">=</span> <span class="type">UUID</span>()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;ğŸ†”ğŸ†”ğŸ†” [DetailState] id accessed, generated: <span class="subst">\(newID)</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> newID</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Solution: Use stable explicit identity</span></span><br><span class="line"><span class="comment">//        let id = UUID()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Published</span> <span class="keyword">var</span> state: <span class="type">State</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// MARK: - Textfield logic</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span>(<span class="params">state</span>: <span class="type">State</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.state <span class="operator">=</span> state</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ¸å¿ƒå°±åœ¨äºé€šè¿‡ Navigator push Detail é¡µé¢æ—¶ï¼ŒDetailState çš„ explicit identity ä¸ç¨³å®šã€‚æ¯æ¬¡æ±‚å€¼ <code>body</code> éƒ½ä¼šé‡æ–°è®¿é—® <code>State.id</code>ï¼Œè®¡ç®—å±æ€§æ¯æ¬¡ç”Ÿæˆæ–°çš„ UUIDï¼Œå¯¼è‡´ <code>Identifiable</code> èº«ä»½å˜åŒ–ã€‚SwiftUI è®¤ä¸ºå½“å‰ NavigationStack é¡¶ç«¯å…ƒç´ å˜äº†ï¼Œäºæ˜¯é”€æ¯æ—§çš„ Detail é¡µé¢å¹¶åˆ›å»ºæ–°çš„ Detail é¡µé¢ã€‚</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Button</span>(<span class="string">&quot;Show Detail&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> state: <span class="type">DetailState</span> <span class="operator">=</span> .<span class="keyword">init</span>(title: <span class="string">&quot;Detail Title&quot;</span>, subtitle: <span class="string">&quot;Detail subtitle&quot;</span>)</span><br><span class="line">    navigator.push(to: .detail(state))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œ Swift Instruments æ¥çœ‹çœ‹è§†å›¾çš„å˜åŒ–æ¬¡æ•°ï¼š</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2025/swiftui_identity_lifetime/assets/12.jpg" alt="10.jpg"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šåœ¨çŸ­çŸ­å‡ ç§’ä¹‹å†…ï¼ŒDetailView æ›´æ–°äº†å°†è¿‘ 5000 æ¬¡ï¼ŒSwiftUI å†…éƒ¨çš„ NavigationStack æ›´æ–°äº†å°†è¿‘ä¸€ä¸‡äº”åƒæ¬¡ï¼Œæ•´ä¸ª app å‡ºç°äº†ä¸¥é‡çš„å¡é¡¿ï¼</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/SwiftUI/" rel="tag"># SwiftUI</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/06/23/Swift-Protocol-Witness/" rel="prev" title="Protocol Witness in Swift">
                  <i class="fa fa-angle-left"></i> Protocol Witness in Swift
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Sunset Wan</span>
  </div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="è¿”å›é¡¶éƒ¨">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
