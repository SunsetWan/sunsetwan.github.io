<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sunsetwan.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="æœ¬æ–‡æ‰€å¼•ç”¨çš„ä¿¡æ¯æºä¸ºï¼š  UIKonf 2017 â€“ Day 2 â€“ Mischa Hildebrand â€“ Auto Layout: From Trailing to Leading The Auto Layout Comprehendiumâ„¢ Mysteries of Auto Layout, Part 1 Mysteries of Auto Layout, Part 2 High Perfo">
<meta property="og:type" content="article">
<meta property="og:title" content="æˆ‘æ‰€ç†è§£çš„ Auto Layout">
<meta property="og:url" content="https://sunsetwan.github.io/2020/12/15/page/index.html">
<meta property="og:site_name" content="æ—¥è½å¤§é“">
<meta property="og:description" content="æœ¬æ–‡æ‰€å¼•ç”¨çš„ä¿¡æ¯æºä¸ºï¼š  UIKonf 2017 â€“ Day 2 â€“ Mischa Hildebrand â€“ Auto Layout: From Trailing to Leading The Auto Layout Comprehendiumâ„¢ Mysteries of Auto Layout, Part 1 Mysteries of Auto Layout, Part 2 High Perfo">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076722742049.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076730816332.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076732745817.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076763626907.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076908613923.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16077023483488.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077454403879.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077486668664.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077488913676.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077496462128.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077501367931.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077508539211.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077525026076.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077531178518.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079497159474.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079519649081.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079523622900.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079529519159.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079530878940.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079563714920.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/15/16080086909737.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/15/16080003273663.jpg">
<meta property="og:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/15/16080003273663.jpg">
<meta property="article:published_time" content="2020-12-15T08:29:38.000Z">
<meta property="article:modified_time" content="2020-12-15T08:31:02.270Z">
<meta property="article:author" content="Sunset Wan">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076722742049.jpg">

<link rel="canonical" href="https://sunsetwan.github.io/2020/12/15/page/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>æˆ‘æ‰€ç†è§£çš„ Auto Layout | æ—¥è½å¤§é“</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">æ—¥è½å¤§é“</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>é¦–é¡µ</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>å…³äº</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>å½’æ¡£</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://sunsetwan.github.io/2020/12/15/page/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Sunset Wan">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ—¥è½å¤§é“">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          æˆ‘æ‰€ç†è§£çš„ Auto Layout
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2020-12-15 16:29:38 / ä¿®æ”¹æ—¶é—´ï¼š16:31:02" itemprop="dateCreated datePublished" datetime="2020-12-15T16:29:38+08:00">2020-12-15</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>æœ¬æ–‡æ‰€å¼•ç”¨çš„ä¿¡æ¯æºä¸ºï¼š</p>
<ol>
<li><a href="https://www.youtube.com/watch?v=xjArhdrqAn8&feature=emb_title" target="_blank" rel="noopener">UIKonf 2017 â€“ Day 2 â€“ Mischa Hildebrand â€“ Auto Layout: From Trailing to Leading</a></li>
<li><a href="https://mischa-hildebrand.de/en/2017/11/the-auto-layout-comprehendium/" target="_blank" rel="noopener">The Auto Layout Comprehendiumâ„¢</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2015/218/" target="_blank" rel="noopener">Mysteries of Auto Layout, Part 1</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2015/219/" target="_blank" rel="noopener">Mysteries of Auto Layout, Part 2</a></li>
<li><a href="https://developer.apple.com/videos/play/wwdc2018/220/" target="_blank" rel="noopener">High Performance Auto Layout</a></li>
<li><a href="https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/AutolayoutPG/index.html" target="_blank" rel="noopener">Auto Layout Guide</a>    </li>
</ol>
<h2 id="ä»€ä¹ˆæ˜¯-layout-ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯-layout-ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯ layout ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯ layout ï¼Ÿ</h2><p>layout çš„èŒè´£æ˜¯å›ç­”è¿™ä¸¤ä¸ªé—®é¢˜ï¼š<br>    1. what to draw?<br>    2. where to draw?<br>å…³äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå…¶å®å¾ˆå¥½ç†è§£ï¼šlayout ç©¶ç«Ÿæ˜¯ layout ä»€ä¹ˆï¼Ÿå½“ç„¶æ˜¯ UIView å’Œå…¶ä»–æ§ä»¶å•¦ï¼Œé…åˆä¸‹å›¾å¾ˆå¥½ç†è§£ã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076722742049.jpg" alt=""><br>å…³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œlayout è¦ç¡®å®š subviews çš„ frameã€‚æ ¹æ®å®ƒä»¬çš„ frameï¼ŒæŠŠ subviews å¸ƒå±€åœ¨å±å¹•ä¸Šã€‚</p>
<h3 id="é‚£æ€ä¹ˆç¡®å®š-subviews-çš„-frame-å‘¢ï¼Ÿ"><a href="#é‚£æ€ä¹ˆç¡®å®š-subviews-çš„-frame-å‘¢ï¼Ÿ" class="headerlink" title="é‚£æ€ä¹ˆç¡®å®š subviews çš„ frame å‘¢ï¼Ÿ"></a>é‚£æ€ä¹ˆç¡®å®š subviews çš„ frame å‘¢ï¼Ÿ</h3><ol>
<li>æ‰‹åŠ¨è®¾ç½® subviews çš„ frame å¤§å°ã€‚</li>
<li>åˆ©ç”¨ constraint anchor æ¥æè¿° subviews ä¹‹é—´ frame çš„å…³ç³»ã€‚    </li>
</ol>
<p>ç°åœ¨ iPhone çš„å±å¹•å°ºå¯¸è¶Šæ¥è¶Šå¤šï¼Œç¬¬ä¸€ç§æ–¹æ³•çš„ç”¨æ­¦ä¹‹åœ°å·²ç»å¾ˆæœ‰é™äº†ã€‚<br>æ‰€ä»¥æˆ‘ä»¬å¸¸ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå³ä½¿ç”¨çº¿æ€§æ–¹ç¨‹ç»„æ¥æè¿° constraint anchor ä¹‹é—´çš„å…³ç³»ã€‚Layout engine åˆ™ä¼šæ ¹æ®è¿™ä¸ªæ–¹ç¨‹ç»„æ¥è®¡ç®—å‡º subviews çš„ frame å¤§å°ã€‚çº¿æ€§æ–¹ç¨‹ç»„ä¸­çš„ç­‰å¼æ ¼å¼å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076730816332.jpg" alt="">    </p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076732745817.jpg" alt=""><br>åœ¨å·²çŸ¥ leadingã€topã€trailing å’Œ bottom å››ç§ anchor çš„æƒ…å†µä¸‹ï¼ŒLayout engine é€šè¿‡ä»¥ä¸Šç®€å•æ¨ç®—å°±èƒ½ç®—å‡º subviews çš„ frame äº†ã€‚</p>
<p>ä¸éš¾å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šå¦‚æœä¸€ä¸ª view çŸ¥é“è‡ªå·±çš„ frameï¼Œå°±èƒ½é€šè¿‡çº¿æ€§æ–¹ç¨‹ç»„è®¡ç®—å‡º subviews çš„ frameã€‚é‚£ä¹ˆå¼€å§‹é€’å½’ï¼Œåªè¦çŸ¥é“äº† rootView çš„ frameï¼Œè¿™æ · subviews çš„ frame éƒ½èƒ½é€šè¿‡çº¿æ€§æ–¹ç¨‹ç»„ç®—å‡ºæ¥ã€‚è€Œ rootView ï¼ˆå³ UIWindowï¼‰åœ¨è¿è¡Œæ—¶æ˜¯èƒ½ç¡®å®š frameï¼ˆå³å±å¹•å°ºå¯¸ï¼‰çš„ã€‚</p>
<p>è®¡ç®—å¥½çš„ frame æ•°æ®ä¼šé€šçŸ¥ç»™å¯¹åº”çš„ superviewï¼Œsuperview ä¼šæ ¹æ®æ­¤æ•°æ®å¯¹ subviews è¿›è¡Œå¸ƒå±€ï¼Œå³è°ƒç”¨ <code>layoutsubViews()</code>ã€‚<code>layoutsubViews()</code> ä¼šåœ¨ä¸€ä¸ª layout pass å‡ºç°æ—¶è¢«è°ƒç”¨ã€‚<br>ä½†ä»¤äººæ²®ä¸§çš„æ˜¯ï¼Œæˆ‘ä»¬æ— ä»å¾—çŸ¥ layout pass å‡†ç¡®å‘ç”Ÿçš„æ—¶é—´ã€‚æ‰€ä»¥å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾—æ‰‹åŠ¨è§¦å‘ layout passã€‚</p>
<h3 id="é‚£ä¹ˆè¯¥å¦‚ä½•æ‰‹åŠ¨è§¦å‘-layout-pass-å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆè¯¥å¦‚ä½•æ‰‹åŠ¨è§¦å‘-layout-pass-å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆè¯¥å¦‚ä½•æ‰‹åŠ¨è§¦å‘ layout pass å‘¢ï¼Ÿ"></a>é‚£ä¹ˆè¯¥å¦‚ä½•æ‰‹åŠ¨è§¦å‘ layout pass å‘¢ï¼Ÿ</h3><p>ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„æ˜¯ï¼šæ‰‹åŠ¨è°ƒç”¨ <code>layoutsubViews()</code> ä¸å°±è¡Œäº†ï¼Ÿ<br>æ ¹æ® Apple çš„<a href="https://developer.apple.com/documentation/uikit/uiview/1622482-layoutsubViews" target="_blank" rel="noopener">æ–‡æ¡£</a>ï¼šä¸ï¼Œä¸è¡ŒğŸ™…â€â™‚ï¸<br>æˆ‘ä»¬ä¸åº”è¯¥æ‰‹åŠ¨è°ƒç”¨ <code>layoutsubViews()</code>ï¼Œè€Œæ˜¯å»è°ƒç”¨<code>layoutIfNeeded()</code><br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæ€§èƒ½é—®é¢˜ã€‚å³ä½¿åœ¨æ–¹ç¨‹ç»„æ²¡æœ‰å˜åŒ–çš„æƒ…å†µä¸‹ï¼Œengine è¿˜æ˜¯ä¼šè§£ä¸€éåŒæ ·çš„æ–¹ç¨‹ç»„ã€‚å½“è¿™æ–¹ç¨‹ç»„æ¯”è¾ƒå¤æ‚æ—¶ï¼ˆè®¾ç½®çš„ constraints æœ‰å¾ˆå¤šæ—¶ï¼‰ï¼Œå°±ä¼šé€ æˆä¸å¿…è¦çš„æ€§èƒ½æµªè´¹ã€‚<br>æ›´å¥½çš„åšæ³•æ˜¯ï¼š</p>
<ol>
<li>æ£€æŸ¥å½“å‰ constraints æ˜¯å¦å‘ç”Ÿæ”¹å˜</li>
<li>å¦‚æœ‰æ”¹å˜ï¼Œå°±æ„å‘³ç€éœ€è¦é‡æ–°è®¡ç®— subviews çš„ frameï¼Œè¿›è¡Œé‡æ–°å¸ƒå±€ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€ã€‚</li>
<li>åœ¨ layout pass å‡ºç°æ—¶ï¼Œä»…åœ¨å½“å‰å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€æ—¶ï¼Œlayout engine é‡æ–°è§£æ–¹ç¨‹ç»„ã€‚</li>
</ol>
<h4 id="é‚£å¦‚ä½•æ£€æŸ¥å½“å‰-constraints-æ˜¯å¦å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿ"><a href="#é‚£å¦‚ä½•æ£€æŸ¥å½“å‰-constraints-æ˜¯å¦å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿ" class="headerlink" title="é‚£å¦‚ä½•æ£€æŸ¥å½“å‰ constraints æ˜¯å¦å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿ"></a>é‚£å¦‚ä½•æ£€æŸ¥å½“å‰ constraints æ˜¯å¦å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿ</h4><p>æˆ‘ä»¬å¯ä»¥æƒ³è±¡ Auto Layout æ¡†æ¶é‡Œæœ‰è¿™ä¹ˆä¸€ä¸ª private variableï¼š<br><code>var needsLayout: Bool</code><br>å½“ <code>needsLayout</code> ä¸º <code>false</code> æ—¶ï¼Œè¡¨æ˜å½“å‰çš„å¸ƒå±€å‡ä¸ºæœ€æ–°çŠ¶æ€ã€‚<br>å½“ <code>needsLayout</code> ä¸º <code>true</code> æ—¶ï¼Œè¡¨æ˜æœ‰äº› subview çš„ frame ä¸æ˜¯æœ€æ–°çŠ¶æ€ä¸”å®ƒçš„ frame éœ€è¦è¢«é‡æ–°è®¡ç®—ã€‚<br>ä¸Šæ–‡å…¶å®å¯¹äº <code>layoutsubViews()</code> è¢«è°ƒç”¨çš„æ—¶å€™å…¶å®æ²¡è¡¨è¿°å®Œæ•´ã€‚<br>å½“ layout pass å‡ºç°ä¸”ä»…å½“ <code>needsLayout</code> ä¸º <code>true</code> æ—¶ï¼Œ<code>layoutsubViews()</code> æ‰ä¼šè¢«è°ƒç”¨ã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076763626907.jpg" alt=""></p>
<p>è™½ç„¶å†…éƒ¨çš„å®ç°ä¸ä¸€å®šå°±å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½†äº†è§£å’Œå…¶ç›¸ä¼¼çš„è¡Œä¸ºæœ‰åŠ©äºå¸®åŠ©æˆ‘ä»¬æé«˜å¯¹ Auto layout è¿™ä¸ªå·¨å¤§é»‘ç›’çš„ç†è§£ã€‚</p>
<h4 id="é‚£ä¹ˆå¦‚ä½•æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€å‘¢ï¼Ÿ"><a href="#é‚£ä¹ˆå¦‚ä½•æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€å‘¢ï¼Ÿ" class="headerlink" title="é‚£ä¹ˆå¦‚ä½•æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€å‘¢ï¼Ÿ"></a>é‚£ä¹ˆå¦‚ä½•æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€å‘¢ï¼Ÿ</h4><p>å½“ä½ è¿›è¡Œä»¥ä¸‹ä¸‰ç§æ“ä½œæ—¶ï¼š</p>
<ol>
<li>æ·»åŠ æˆ–ç§»é™¤ constraints</li>
<li>ä¿®æ”¹å·²æœ‰çš„ constraints</li>
<li>åœ¨è§†å›¾å±‚çº§ä¸Šæ·»åŠ æˆ–åˆ é™¤ view<br><code>needsLayout</code> ä¼šè‡ªåŠ¨è®¾ç½®ä¸º <code>true</code>ã€‚<br>ç›¸ååœ°ï¼Œå½“ layout pass ç»“æŸæ—¶ï¼ˆ<code>layoutsubViews()</code> æ‰§è¡Œå®Œæ¯•æ—¶ï¼‰ï¼Œ <code>needsLayout</code> ä¼šè‡ªåŠ¨è®¾ç½®ä¸º <code>false</code>ã€‚</li>
</ol>
<p>ä½†æœ‰æ—¶å€™ï¼Œä½ ä¼šéœ€è¦æ‰‹åŠ¨æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€ï¼ˆå³æŠŠ <code>needsLayout</code> ä¸º <code>True</code>ï¼‰ï¼Œä½ å¯ä»¥æ‰‹åŠ¨è°ƒç”¨ <code>setNeedsLayout()</code>ã€‚è¿™æ ·åœ¨ä¸‹ä¸€ä¸ª layout pass å‡ºç°æ—¶ï¼Œä¼šå¼ºåˆ¶è°ƒç”¨ <code>layoutsubViews()</code>ã€‚</p>
<p>å°† <code>setNeedsLayout()</code> å’Œ <code>layoutIfNeeded()</code> ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥ç«‹å³è§¦å‘ layout passï¼Œå³ä¼šå¾ˆå¿«è§¦å‘ <code>layoutsubViews()</code>ã€‚</p>
<p>æˆ‘ä»¬å½“ç„¶å¯ä»¥ override <code>layoutsubViews()</code> æ¥å®ç°ä¸€äº›è‡ªå®šä¹‰çš„å¸ƒå±€ï¼Œä½†éœ€è¦è°¨æ…çš„æ˜¯ï¼šåªæœ‰å½“æŸä¸ªå¸ƒå±€ä¸èƒ½é€šè¿‡è®¾å®š constraints æ¥è§£å†³æ—¶ï¼Œæ‰çœŸæ­£éœ€è¦ override <code>layoutsubViews()</code>ã€‚</p>
<p>å½“ override <code>layoutsubViews()</code> æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½è°ƒç”¨ <code>setNeedsUpdateConstraints()</code>ï¼Œè¿™æ ·ä¼šå¾ˆå®¹æ˜“å¯¼è‡´å¸ƒå±€åé¦ˆå¾ªç¯ï¼ˆlayout feedback loopï¼‰ã€‚è¿™ç¯‡ <a href="https://www.hackingwithswift.com/articles/59/debugging-auto-layout-feedback-loops" target="_blank" rel="noopener">æ–‡ç« </a> ä»‹ç»äº†å¦‚ä½•è°ƒè¯•è¿™ä¸€é—®é¢˜ã€‚</p>
<p>åŒæ ·åœ°ï¼Œå°† <code>setNeedsUpdateConstraints()</code> å’Œ <code>updateConstraintsIfNeeded()</code> ç»„åˆä½¿ç”¨ï¼Œä¼šå¾ˆå¿«è§¦å‘ <code>updateConstraints()</code></p>
<h2 id="é‚£-updateConstraints-åˆæ˜¯å¹²å•¥çš„ï¼Ÿ"><a href="#é‚£-updateConstraints-åˆæ˜¯å¹²å•¥çš„ï¼Ÿ" class="headerlink" title="é‚£ updateConstraints() åˆæ˜¯å¹²å•¥çš„ï¼Ÿ"></a>é‚£ updateConstraints() åˆæ˜¯å¹²å•¥çš„ï¼Ÿ</h2><p>å¼•ç”¨ Apple æ–‡æ¡£ï¼š</p>
<blockquote>
<p>It is almost always cleaner and easier to update a constraint immediately after the affecting change has occurred. For example, if you want to change a constraint in response to a button tap, make that change directly in the buttonâ€™s action method.    </p>
</blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€åœ¨ constraints éœ€è¦æ”¹å˜çš„æ—¶æœºå»æ›´æ–° constraintsã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯å¢å¼ºä»£ç çš„æ˜“è¯»æ€§å’Œå¯ç»´æŠ¤æ€§</p>
<p>ä½†æœ‰äº›æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦ä¿®æ”¹å¤§é‡çš„ constraints æ—¶ï¼Œæ²¿ç”¨ä¸Šè¿°çš„æ–¹æ³•ï¼Œå¯èƒ½ä¼šè§‰å¾—å¾ˆæ…¢ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©å» override <code>updateConstraints()</code>ã€‚Layout engine å°±å¯ä»¥åœ¨åŒä¸€æ—¶åˆ»æ‰¹é‡å¤„ç†è¿™äº› constraints çš„æ”¹å˜ï¼Œä»è€Œæå‡æ€§èƒ½ã€‚ä½†éœ€è¦è®°ä½çš„æ˜¯ï¼šåªæœ‰å½“åŒæ—¶ä¿®æ”¹å¤§é‡ constraints æ—¶ï¼Œæ‰éœ€è¦å» override è¿™ä¸ªæ–¹æ³•ã€‚</p>
<p><code>updateConstraints()</code> å¾€å¾€åœ¨ layout pass å‡ºç°ä¹‹å‰ä¸”ä¸€äº› constraints å¤„äºå¤±æ•ˆçŠ¶æ€æ—¶ï¼ˆå³éœ€è¦æ›´æ–°æ—¶ï¼‰è¢«è°ƒç”¨ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨ <code>updateConstraintsIfNeeded()</code> æ¥ä½¿ <code>updateConstraints()</code> è¢«è°ƒç”¨ã€‚</p>
<p>ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>setNeedsUpdateConstraints()</code> æ¥æ‰‹åŠ¨æŠŠå½“å‰çš„ constraints æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€ã€‚</p>
<h2 id="Auto-Layout-Debug-æŠ€å·§"><a href="#Auto-Layout-Debug-æŠ€å·§" class="headerlink" title="Auto Layout Debug æŠ€å·§"></a>Auto Layout Debug æŠ€å·§</h2><h3 id="translatesAutoresizingMaskIntoConstraints"><a href="#translatesAutoresizingMaskIntoConstraints" class="headerlink" title="translatesAutoresizingMaskIntoConstraints"></a>translatesAutoresizingMaskIntoConstraints</h3><p>ä» IB ä¸­ç”Ÿæˆçš„ UIView çš„ <code>translatesAutoresizingMaskIntoConstraints</code> ï¼ˆä¹‹åç®€ç§°ä¸º <code>tAMIC</code>ï¼‰é»˜è®¤ä¸º <code>false</code>ï¼Œè€Œä»£ç ç”Ÿæˆçš„ UIView çš„<code>tAMIC</code> é»˜è®¤ä¸º <code>true</code>ã€‚<br>å½“æŸä¸ª view æ˜¯ä½¿ç”¨ Auto Layout æ¥å¸ƒå±€æ—¶ï¼Œéœ€è¦ä¿è¯å®ƒçš„ <code>tAMIC</code> ä¸º <code>true</code>ï¼Œåä¹‹ï¼Œå¦‚æœæ˜¯é€šè¿‡æ‰‹åŠ¨è®¾ç½®å®ƒçš„ frame æ¥å¸ƒå±€çš„è¯ï¼Œå®ƒçš„ <code>tAMIC</code> éœ€ä¸º <code>false</code>ã€‚å…¶å®ï¼Œæ‰‹åŠ¨è®¾ç½® view çš„ frame çš„å¸ƒå±€æ–¹å¼èƒŒåœ°é‡Œä»ç„¶æ˜¯ä½¿ç”¨ auto layout çš„æ–¹å¼åœ¨å¸ƒå±€ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘åœ¨ viewDidLoad() ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">label.translatesAutoresizingMaskIntoConstraints &#x3D; true</span><br><span class="line">view.addSubview(label)</span><br><span class="line">label.frame &#x3D; CGRect(x: 100, y: 100, width: 100, height: 100)</span><br></pre></td></tr></table></figure>

<p>æ‰“æ–­ç‚¹è¿›å…¥è°ƒè¯•çŠ¶æ€ï¼ŒæŸ¥çœ‹è¯¥ label çš„ constraints:<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16076908613923.jpg" alt=""></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œæ‰‹åŠ¨è®¾ç½®çš„ frame åœ¨èƒŒåœ°é‡Œè½¬æ¢æˆå¯¹åº”çš„<code>NSAutoresizingMaskLayoutConstraint</code> æ¥è¿›è¡Œå¸ƒå±€äº†ã€‚</p>
<h3 id="Unsatisfiable-Constraints"><a href="#Unsatisfiable-Constraints" class="headerlink" title="Unsatisfiable Constraints"></a>Unsatisfiable Constraints</h3><p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/11/16077023483488.jpg" alt=""><br>ä»¥ layout engine ä¸»åŠ¨é€‰æ‹© break çš„é‚£æ¡ constraint ä¸ºçªç ´ç‚¹å»ç ”ç©¶åˆ°åº•æ˜¯å“ªé‡Œå‘ç”Ÿå†²çªäº†ã€‚è¿˜å¯ä»¥å¯¹å¯ç–‘çš„ constraint å’Œ view å„è‡ªåŠ ä¸Š identifier å’Œ accessibilityIdentifier æ¥æé«˜ä¸Šå›¾ log çš„å¯è¯»æ€§ã€‚<br>è¯¦è§ <a href="https://developer.apple.com/videos/play/wwdc2015/219/" target="_blank" rel="noopener">Mysteries of Auto Layout, Part 2</a> [20:18] å¤„</p>
<h3 id="Ambiguous-Layouts"><a href="#Ambiguous-Layouts" class="headerlink" title="Ambiguous Layouts"></a>Ambiguous Layouts</h3><p>è¿™ç§æƒ…å†µå¯èƒ½åŸå› æœ‰ï¼š</p>
<ol>
<li>constraint å¤ªå°‘ï¼Œæ— æ³•è®¡ç®—å‡ºç¡®å®šçš„ frame</li>
<li>constraint çš„ priority å‘ç”Ÿå†²çª</li>
</ol>
<p>å½“å‘ç”Ÿ ambiguous layout æ—¶ï¼ŒæŸä¸ª view çš„ frame å…¶å®æ˜¯æœ‰å¤šç§å¯èƒ½çš„ï¼Œlayout engine é€‰æ‹©å…¶ä¸­ä¸€ç§æ¥å®Œæˆå¸ƒå±€ã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077454403879.jpg" alt=""><br>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ï¼š<br><code>po view.value(forKey: &quot;_autolayoutTrace&quot;)!</code> æ‰“å°å‡ºå½“å‰è§†å›¾å±‚çº§ï¼Œå¯ä»¥å¾ˆç›´è§‚åœ°çœ‹å‡ºæ˜¯å“ªä¸ª subview å‡ºç°äº† ambiguous layouts çš„æƒ…å†µã€‚<br>æˆ‘ä»¬ç”šè‡³è¿˜å¯ä»¥åœ¨ Xcode debug area æ‰§è¡Œ <code>e label.exerciseAmbiguityInLayout()</code> ï¼Œç„¶åæ‰§è¡Œ <code>continue</code> å‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°å…¶ä»–å¯èƒ½çš„å¸ƒå±€ã€‚è¿™æ ·ï¼Œä¸¤ç§åŒç±»å¸ƒå±€ä¸€å¯¹æ¯”å°±æ¯”è¾ƒå®¹æ˜“æ‰¾åˆ°é—®é¢˜çš„æ ¹æºã€‚<br>è¯¦è§ <a href="https://developer.apple.com/videos/play/wwdc2015/219/" target="_blank" rel="noopener">Mysteries of Auto Layout, Part 2</a> [28:18] å¤„</p>
<h2 id="High-Performance-Auto-Layout"><a href="#High-Performance-Auto-Layout" class="headerlink" title="High Performance Auto Layout"></a>High Performance Auto Layout</h2><p>æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªç®€å•ä¾‹å­ï¼š<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077486668664.jpg" alt=""></p>
<p>è¿™æ ·ä¸€ä¸ªç®€å•å¸ƒå±€æ˜¯æ— é¡»å¤§è´¹å‘¨ç« å» override <code>updateConstraints()</code>ï¼Œæˆ‘ä»¬è¿™é‡Œä¸¾ä¸€ä¸ªåä¾‹ï¼Œä»¥æ›´å¥½åœ°ç†è§£ Auto Layout è¿™ä¸ªé»‘ç›’ã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077488913676.jpg" alt=""></p>
<p>åœ¨è¿™é‡Œæ–¹æ³•é‡Œï¼šé¦–å…ˆ deactivate constraintsï¼Œç„¶åé‡æ–°æ·»åŠ  constraintsï¼Œæœ€åå† activate constraintsã€‚</p>
<p>ä»ç›®å‰çš„ç›´è§‰ä¸Šæ¥çœ‹ï¼Œè¿™æ ·åšå¥½åƒçœ‹ä¸å‡ºæœ‰ä»€ä¹ˆæŸè€—æ€§èƒ½çš„åœ°æ–¹ã€‚</p>
<h3 id="Render-Loop"><a href="#Render-Loop" class="headerlink" title="Render Loop"></a>Render Loop</h3><p>ä¸ºäº†ç†è§£ä¸Šè¿°ä»£ç å¯¹æ€§èƒ½çš„å½±å“ï¼Œæˆ‘ä»¬éœ€è¦æ›´å…·ä½“åœ°äº†è§£ <code>updateConstraints()</code>ï¼Œè¿™é‡Œä»‹ç» Render Loopã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077496462128.jpg" alt=""></p>
<p>Render Loop æ˜¯ä¸€ä¸ªæ¯ç§’å¯èƒ½è¿è¡Œ 120 æ¬¡çš„è¿›ç¨‹ï¼Œä»¥ç¡®ä¿æ¯ä¸ª subview å‡æ°å½“åœ°æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚å®ƒåŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«æ˜¯ï¼šUpdate Constraintsã€Layout ä»¥åŠ Displayã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077501367931.jpg" alt=""></p>
<p>ç¬¬ä¸€é˜¶æ®µï¼šä»è§†å›¾å±‚çº§çš„<strong>åº•éƒ¨</strong>åˆ°<strong>é¡¶éƒ¨</strong>ï¼Œæ¯ä¸ª view éƒ½ä¼šè°ƒç”¨ <code>updateConstraints()</code>ã€‚<br>ç¬¬äºŒé˜¶æ®µï¼šä»è§†å›¾å±‚çº§çš„<strong>é¡¶éƒ¨</strong>åˆ°<strong>åº•éƒ¨</strong>ï¼Œæ¯ä¸ª view éƒ½ä¼šè°ƒç”¨ <code>layoutsubViews()</code>ã€‚<br>ç¬¬ä¸‰é˜¶æ®µï¼šä»è§†å›¾å±‚çº§çš„<strong>é¡¶éƒ¨</strong>åˆ°<strong>åº•éƒ¨</strong>ï¼Œæ¯ä¸ª view ä¼šåˆ¤æ–­è‡ªå·±æ˜¯å¦éœ€è¦æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077508539211.jpg" alt=""><br>åƒä¸Šå›¾è¿™æ ·æŠŠè¿™å‡ ç§æ–¹æ³•åˆ—åœ¨è¡¨æ ¼ä¸­æ˜¯ä¸ºäº†è¯´æ˜<strong>è¿™äº›æ–¹æ³•æ˜¯ç›¸ä¼¼çš„ï¼Œæ˜¯å¯ä»¥ç”¨æ¥ç±»æ¯”çš„</strong>ã€‚</p>
<p>æ‰€ä»¥æ•´ä¸ª Render Loop å­˜åœ¨çš„ç›®çš„å°±æ˜¯ï¼š</p>
<ol>
<li>é¿å…æ— ç”¨çš„è®¡ç®—è¿‡ç¨‹</li>
<li>æ¨è¿Ÿä¸€äº›è®¡ç®—è¿‡ç¨‹ï¼ˆä¸ºçš„æ˜¯åœ¨æŸä¸ªæ—¶åˆ»è¿›è¡Œé›†ä¸­è®¡ç®—ï¼‰</li>
<li>å¦‚æœæœ‰å¯èƒ½ï¼Œè·³è¿‡è¿™äº›è®¡ç®—è¿‡ç¨‹</li>
</ol>
<p>å›å¤´çœ‹è¿™æ®µä»£ç ï¼š<br><a href="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077488913676.jpg" target="_blank" rel="noopener"></a><br>ä¹‹å‰è¯´è¿‡ <code>updateConstraints()</code> æ˜¯å¯ä»¥åŒ <code>layoutSubviews()</code> ç±»æ¯”çš„ã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077525026076.jpg" alt=""><br>åœ¨ <code>layoutsubViews()</code> æ¯æ¬¡è¢«è°ƒç”¨æ—¶ï¼Œæ‰€æœ‰çš„ subviews éƒ½è¢«é”€æ¯ï¼Œç„¶åå†é‡æ–°åˆ›å»º subviewsï¼Œå¹¶æŠŠå®ƒä»¬æ·»åŠ åˆ° superview ä¸Šã€‚<br>ç»å¤§å¤šæ•°äººçœ‹åˆ° <code>layoutsubViews()</code> è¿™æ®µä»£ç æ—¶ï¼Œè‚¯å®šä¼šæœ‰ä¸€ç§ã€Œè¿™æ ·åšä¼šå½±å“åˆ°æ€§èƒ½ã€çš„ç›´è§‰ã€‚    </p>
<p>åŒç†ï¼Œé‚£æ®µ <code>updateConstraints()</code> ä¹Ÿæ˜¯å¦‚æ­¤ï¼    </p>
<p>æ‰€ä»¥æˆ‘ä»¬åªéœ€æƒ³æ–¹è®¾æ³•ç¡®ä¿ <code>updateConstraints()</code> å†…çš„åšæ³•åªæ‰§è¡Œä¸€æ¬¡å°±å¯ä»¥é¿å…å¯¹æ€§èƒ½çš„æŸè€—ã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/12/16077531178518.jpg" alt=""></p>
<p>æˆ‘ä»¬é€šè¿‡ç±»æ¯”ï¼Œå¼€å§‹æ˜ç™½ <code>updateConstraints()</code> é‚£æ®µä»£ç æ˜¯ä¸å¥½çš„ä»£ç ã€‚ä½†æˆ‘ä»¬çš„ç›®çš„ä¸æ˜¯ä¸ºäº†ä»…æ˜¯è¯´æ˜è¿™æ®µä»£ç ä¸å¥½ï¼Œè€Œæ˜¯è¦å°½é‡æŠ½ä¸å‰¥èŒ§ï¼Œç†è§£èƒŒåçš„åŸç†ã€‚</p>
<h3 id="Activate-constraints-èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"><a href="#Activate-constraints-èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Activate constraints èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"></a>Activate constraints èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3><p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079497159474.jpg" alt=""><br>åœ¨å¯¹ view æ·»åŠ  constraints ä¹‹åï¼Œengine ä¼šå¼€å§‹è®¡ç®—è¡¨ç¤º constraints çš„æ–¹ç¨‹ç»„ï¼Œç„¶åå†æŠŠæ–¹ç¨‹ç»„çš„è§£ï¼ˆè¯¥ view çš„ frame æ•°æ®ï¼Œå³ minXã€minYã€width å’Œ heightï¼‰å‘ŠçŸ¥ viewã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079519649081.jpg" alt=""><br>ä»¥ä¸Šå›¾è¿™ä¸ªç®€å•å¸ƒå±€ä¸ºä¾‹ï¼ˆä»…å…³æ³¨æ°´å¹³æ–¹å‘ä¸Šçš„å¸ƒå±€ï¼‰ã€‚<br>Layout engine å°±å¼€å§‹è®¡ç®—ä¸€ä¸ªç®€å•çš„æ–¹ç¨‹ç»„ï¼š<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079523622900.jpg" alt=""></p>
<p>è®¡ç®—å®Œæ¯•åï¼Œlayout engine ä¼šé€šçŸ¥ viewã€‚ç„¶å view å‘å®ƒè‡ªå·±çš„ superview å‘é€ <code>setNeedsLayout()</code> ä¿¡æ¯ã€‚</p>
<p>æ­¤æ—¶å°±è¿›å…¥ Render Loop çš„ç¬¬äºŒé˜¶æ®µ <code>Layout</code>ï¼š<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079529519159.jpg" alt=""></p>
<p>åœ¨ <code>layoutSubViews()</code> ä¸­ï¼Œview ä» engine ä¸­è¯»å–æ–¹ç¨‹ç»„çš„è§£ï¼ˆframe æ•°æ®ï¼‰è¿›è¡Œå¸ƒå±€ã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079530878940.jpg" alt=""></p>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±å¾ªåºæ¸è¿›åœ°èµ°è¿‡ä¸€é layout çš„è¿‡ç¨‹ã€‚ç›¸ä¿¡ä½ å¯¹è¿™æ•´ä¸ªè¿‡ç¨‹æœ‰äº†æ¯”è¾ƒç›´è§‚çš„äº†è§£ï¼Œè¿™æ ·ä¼šåˆ©äºä½ å¯¹ auto layout çš„æ€§èƒ½åšå‡ºæ°å½“çš„åˆ¤æ–­ã€‚</p>
<p><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/14/16079563714920.jpg" alt=""><br>è®©æˆ‘ä»¬å›é¡¾è¿™æ®µä»£ç ã€‚åœ¨ Render Loop å¯èƒ½ä»¥æ¯ç§’ 120 æ¬¡è°ƒç”¨ <code>updateConstraints()</code> çš„æƒ…å†µä¸‹ï¼Œè¿™æ®µä»£ç ä¸­å…ˆ deactivate constraintsï¼Œç„¶åå† activate constraintsã€‚æˆ‘ä»¬å¯ä»¥ç²—æµ…åœ°ç†è§£ä¸º engine ä¸€ç§’é’Ÿè§£ 120 æ¬¡<strong>åŒæ ·çš„</strong>æ–¹ç¨‹ç»„ï¼è™½ç„¶ engine è§£ä¸€æ¬¡æ–¹ç¨‹ç»„ä¼šå¾ˆå¿«ï¼Œä½†æ˜¯ç´¯è®¡ä¸‹æ¥åœ¨è¿™å„¿ä¼šäº§ç”Ÿå¾ˆå¤§çš„å¼€é”€ï¼Œä¼šå¯¹æ€§èƒ½è¡¨ç°æœ‰ä¸å°çš„å½±å“ï¼</p>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯åœ¨åŒä¸€ superview å†…å¯¹ subviews æ·»åŠ çº¦æŸã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/15/16080086909737.jpg" alt=""><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼štext1 å’Œ text2 æ‹¥æœ‰åŒæ ·çš„ superviewï¼Œtext3 å’Œ text4 æ‹¥æœ‰åŒæ ·çš„ superviewã€‚text1 å’Œ text3 åˆ†åˆ«åœ¨ä¸¤ä¸ªä¸åŒçš„è§†å›¾å±‚çº§é‡Œã€‚<br>æ­¤æ—¶å¸ƒå±€çš„æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œå› ä¸º layout engine å®é™…ä¸Šæ˜¯åœ¨è§£ä¸¤ä¸ªç‹¬ç«‹æ— å…³çš„æ–¹ç¨‹ç»„ã€‚<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/15/16080003273663.jpg" alt=""><br>è€Œå½“éœ€è¦ text1 å’Œ text3 å·¦å¯¹é½æ—¶ï¼š<br><img src="https://imagebed-1301918945.cos.ap-shanghai.myqcloud.com/2020/12/15/16080003273663.jpg" alt=""><br>Layout engine å°±éœ€è¦è§£ä¸¤ä¸ªæœ‰ä¾èµ–å…³ç³»çš„æ–¹ç¨‹ç»„äº†ã€‚å¯æƒ³è€ŒçŸ¥æ­¤æ—¶çš„æ—¶é—´å¤æ‚åº¦å°±ä¸å†æ˜¯çº¿æ€§çš„ï¼Œè®¡ç®—é‡ç›¸è¾ƒä¹‹å‰ä¼šå¢å¤§ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥é€æ¸ä½“ä¼šåˆ°è¿™æ ·ä¸€ä»¶äº‹ï¼š</p>
<blockquote>
<p>The layout engine is a layout cache and dependency tracker</p>
</blockquote>
<p>å…‰å¯¹ Auto Layout è¿™ä¸ªé»‘ç›’æœ‰è¾ƒä¸ºç›´è§‚çš„è®¤çŸ¥è¿˜ä¸å¤Ÿï¼Œè¿˜éœ€è¦é€šè¿‡å®é™…å…·ä½“çš„ä¾‹å­æ¥å¼ºåŒ–è¿™ä»½è®¤çŸ¥ï¼Œå¼ºçƒˆæ¨èçœ‹å®Œ <a href="https://developer.apple.com/videos/play/wwdc2018/220/" target="_blank" rel="noopener">High Performance Auto Layout</a> [26: 15] å¤„çš„ä¾‹å­ã€‚</p>
<h3 id="Intrinsic-Content-Size"><a href="#Intrinsic-Content-Size" class="headerlink" title="Intrinsic Content Size"></a>Intrinsic Content Size</h3><p>å¸¸è§çš„ UI æ§ä»¶ï¼Œå¦‚ UILabel å’Œ UIImageViewã€‚åœ¨ä¸ºå®ƒä»¬è®¾å®šå®Œæ˜¾ç¤ºçš„æ–‡å­—å’Œå›¾ç‰‡åï¼Œå®ƒä»¬ä¼šæœ‰ <code>intrinsicContentSize</code>ï¼Œlayout engine åˆ©ç”¨è¿™ä¸ª <code>intrinsicContentSize</code> ç”Ÿæˆ <code>NSContentSizeLayoutConstraint</code> å¯¹å®ƒä»¬è¿›è¡Œå¸ƒå±€ã€‚<br>å½“éœ€è¦ text measurement æ—¶ï¼Œé€‰æ‹©æ€§åœ°å» override <code>intrinsicContentSize</code> å¯ä»¥æé«˜å¸ƒå±€æ€§èƒ½ã€‚Text measurement çš„å¼€é”€æ˜¯å¾ˆå¤§çš„ï¼Œç‰¹åˆ«æ˜¯åœ¨é‚£äº›å¤§é‡æ˜¾ç¤ºæ–‡æœ¬çš„ app ä¸­ã€‚    </p>
<p>å¦‚æœåœ¨æ— éœ€ text measurement å°±å¯ä»¥ç¡®å®šæ–‡æœ¬æ˜¾ç¤ºçš„å¤§å°ï¼Œå°±å¯ä»¥ç›´æ¥ override <code>intrinsicContentSize</code>ï¼Œè¿”å›è¿™ä¸ªç¡®å®šçš„å€¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">override var intrinsicContentSize: CGSize &#123;</span><br><span class="line">    &#x2F;&#x2F; è¿”å›æŸä¸ªç¡®å®šçš„ CGSize</span><br><span class="line">    return CGSize(width: 100, height: 100)</span><br><span class="line">&#125;</span><br><span class="line">&#96;&#96;&#96;     </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">å¦‚æœæ˜¯åˆ©ç”¨ constraints æ¥ç¡®å®šæ–‡æœ¬æ˜¾ç¤ºçš„å¤§å°è€Œä¸æ˜¯æ–‡æœ¬æœ¬èº«çš„å¤§å°ï¼Œå¯ä»¥è¿™æ ·ï¼š</span><br></pre></td></tr></table></figure>
<p>override var intrinsicContentSize: CGSize {<br>    return CGSize(width: UIView.noIntrinsicMetric, height: UIView.noIntrinsicMetric)<br>}</p>
<pre><code>è¿™æ ·åšæ˜¯åœ¨å‘Šè¯‰ superviewï¼šæˆ‘å·²ç»å¯ä»¥é€šè¿‡ constraints æ¥ç¡®å®šæˆ‘è‡ªå·±çš„å¤§å°å•¦ï¼Œæ²¡å¿…è¦è¿›è¡Œ text measurement äº†ã€‚

è°ˆåŠ `intrinsicContentSize`ï¼Œå°±ä¸å¾—ä¸æä¸€å˜´ `systemLayoutSizeFitting(_:)`ï¼Œå› ä¸ºæœ‰æ—¶å€™ä¼šæŠŠå®ƒä¿©æ··ä¸ºä¸€è°ˆã€‚å®é™…ä¸Šå®ƒä¿©å¯ä»¥è¯´æ˜¯æ­£åé¢ã€‚`intrinsicContentSize` æ˜¯ä¼ é€’ç»™ layout engine çš„ä¿¡æ¯ï¼Œè€Œ `systemLayoutSizeFitting(_:)` æ˜¯ layout engine è®¡ç®—å¾—å‡ºçš„ä¿¡æ¯ã€‚

## åè®°
æœ¬æ–‡ä»…æ˜¯ä¸Šé¢å†…å®¹çš„ç²—æµ…çš„ä¸ªäººæ€»ç»“ï¼Œå¦‚æœ‰è¯¯ï¼Œæ¬¢è¿æ‰¹è¯„æŒ‡æ­£ï¼
å¸Œæœ›è‡ªå·±ä»¥ååœ¨å†™ UI çš„æ—¶å€™èƒ½å‡å°‘äº›è®¸ç—›è‹¦ã€‚
















</code></pre>
    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/11/27/how-to-design-rdt/" rel="prev" title="å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯é æ•°æ®ä¼ è¾“åè®®ï¼Ÿ">
      <i class="fa fa-chevron-left"></i> å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯é æ•°æ®ä¼ è¾“åè®®ï¼Ÿ
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          æ–‡ç« ç›®å½•
        </li>
        <li class="sidebar-nav-overview">
          ç«™ç‚¹æ¦‚è§ˆ
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ä»€ä¹ˆæ˜¯-layout-ï¼Ÿ"><span class="nav-number">1.</span> <span class="nav-text">ä»€ä¹ˆæ˜¯ layout ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#é‚£æ€ä¹ˆç¡®å®š-subviews-çš„-frame-å‘¢ï¼Ÿ"><span class="nav-number">1.1.</span> <span class="nav-text">é‚£æ€ä¹ˆç¡®å®š subviews çš„ frame å‘¢ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#é‚£ä¹ˆè¯¥å¦‚ä½•æ‰‹åŠ¨è§¦å‘-layout-pass-å‘¢ï¼Ÿ"><span class="nav-number">1.2.</span> <span class="nav-text">é‚£ä¹ˆè¯¥å¦‚ä½•æ‰‹åŠ¨è§¦å‘ layout pass å‘¢ï¼Ÿ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#é‚£å¦‚ä½•æ£€æŸ¥å½“å‰-constraints-æ˜¯å¦å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿ"><span class="nav-number">1.2.1.</span> <span class="nav-text">é‚£å¦‚ä½•æ£€æŸ¥å½“å‰ constraints æ˜¯å¦å‘ç”Ÿæ”¹å˜å‘¢ï¼Ÿ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#é‚£ä¹ˆå¦‚ä½•æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€å‘¢ï¼Ÿ"><span class="nav-number">1.2.2.</span> <span class="nav-text">é‚£ä¹ˆå¦‚ä½•æŠŠå½“å‰çš„å¸ƒå±€æ ‡è®°ä¸ºå¤±æ•ˆçŠ¶æ€å‘¢ï¼Ÿ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#é‚£-updateConstraints-åˆæ˜¯å¹²å•¥çš„ï¼Ÿ"><span class="nav-number">2.</span> <span class="nav-text">é‚£ updateConstraints() åˆæ˜¯å¹²å•¥çš„ï¼Ÿ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Auto-Layout-Debug-æŠ€å·§"><span class="nav-number">3.</span> <span class="nav-text">Auto Layout Debug æŠ€å·§</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#translatesAutoresizingMaskIntoConstraints"><span class="nav-number">3.1.</span> <span class="nav-text">translatesAutoresizingMaskIntoConstraints</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Unsatisfiable-Constraints"><span class="nav-number">3.2.</span> <span class="nav-text">Unsatisfiable Constraints</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ambiguous-Layouts"><span class="nav-number">3.3.</span> <span class="nav-text">Ambiguous Layouts</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#High-Performance-Auto-Layout"><span class="nav-number">4.</span> <span class="nav-text">High Performance Auto Layout</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Render-Loop"><span class="nav-number">4.1.</span> <span class="nav-text">Render Loop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Activate-constraints-èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ"><span class="nav-number">4.2.</span> <span class="nav-text">Activate constraints èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Intrinsic-Content-Size"><span class="nav-number">4.3.</span> <span class="nav-text">Intrinsic Content Size</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Sunset Wan</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">6</span>
          <span class="site-state-item-name">æ—¥å¿—</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/SunsetWan" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;SunsetWan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sunset Wan</span>
</div>
  <div class="powered-by">ç”± <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> å¼ºåŠ›é©±åŠ¨
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
